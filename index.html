
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>å§¿å‹¢ã‚»ãƒ«ãƒ•ãƒã‚§ãƒƒã‚¯</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>

<style>
body{
 font-family:sans-serif;
 text-align:center;
}
canvas{
 max-width:100%;
}
#result{
 font-size:18px;
 margin-top:15px;
}
</style>

</head>

<body>

<h2>å†™çœŸã§å§¿å‹¢ãƒã‚§ãƒƒã‚¯</h2>

<input type="file" id="upload" accept="image/*">

<br><br>

<canvas id="canvas"></canvas>

<div id="result"></div>

<script>

const upload = document.getElementById("upload");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const pose = new Pose({
 locateFile:file=>"https://cdn.jsdelivr.net/npm/@mediapipe/pose/"+file
});

pose.setOptions({
 modelComplexity:1,
 smoothLandmarks:true
});

pose.onResults(onResults);

function postureJudge(lm){

 const nose = lm[0];
 const ls = lm[11];
 const rs = lm[12];
 const lh = lm[23];
 const rh = lm[24];

 let messages=[];

 // é¦–
 const center=(ls.x+rs.x)/2;
 if(Math.abs(nose.x-center)>0.05){
  messages.push("ğŸ”´ é¦–ãŒå‰ã«å‡ºã¦ã„ã¾ã™");
 }else{
  messages.push("ğŸŸ¢ é¦–ã®ä½ç½®ã¯è‰¯å¥½");
 }

 // è‚©
 if(Math.abs(ls.y-rs.y)>0.05){
  messages.push("ğŸ”´ è‚©ã®é«˜ã•ãŒå·¦å³ã§é•ã„ã¾ã™");
 }else{
  messages.push("ğŸŸ¢ è‚©ã¯æ°´å¹³ã§ã™");
 }

 // éª¨ç›¤
 if(Math.abs(lh.y-rh.y)>0.05){
  messages.push("ğŸ”´ éª¨ç›¤ãŒå‚¾ã„ã¦ã„ã¾ã™");
 }else{
  messages.push("ğŸŸ¢ éª¨ç›¤ãƒãƒ©ãƒ³ã‚¹è‰¯å¥½");
 }

 document.getElementById("result").innerHTML=
  messages.join("<br>")+
  "<br><br>æ°—ã«ãªã‚‹æ–¹ã¯ã‚¹ã‚¿ã‚¸ã‚ªã‚ªã‚ªãƒ†ã‚­ã§å§¿å‹¢ãƒã‚§ãƒƒã‚¯ãŒãŠã™ã™ã‚ã§ã™ ğŸ™‚";
}

function onResults(r){

 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.drawImage(r.image,0,0);

 if(r.poseLandmarks){
  drawConnectors(ctx,r.poseLandmarks,POSE_CONNECTIONS);
  drawLandmarks(ctx,r.poseLandmarks);
  postureJudge(r.poseLandmarks);
 }
}

upload.onchange=e=>{
 const img=new Image();
 img.src=URL.createObjectURL(e.target.files[0]);
 img.onload=async()=>{
  canvas.width=img.width;
  canvas.height=img.height;
  await pose.send({image:img});
 }
};

</script>

</body>
</html>



