
<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>スタジオオオテキ的姿勢判定モード</title>

<script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils"></script>

</head>
<body>
<div id="result" style="font-size:20px;margin-top:15px;"></div>

<script>
function postureJudge(landmarks){

const leftShoulder = landmarks[11];
const rightShoulder = landmarks[12];
const nose = landmarks[0];

const shoulderCenterX =
(leftShoulder.x + rightShoulder.x)/2;

let result = "良い姿勢なので呼吸しやすいかやってみてください";

if(Math.abs(nose.x - shoulderCenterX) > 0.05){
result = " 頭が前に出ています（いわゆる猫背）";
}

document.getElementById("result").innerHTML = result;
}
</script>

<body>

<h2>写真で姿勢チェック</h2>

<input type="file" id="upload" accept="image/*">

<br><br>

<canvas id="canvas"></canvas>

<script>

const upload = document.getElementById("upload");
const canvas = document.getElementById("canvas");
const ctx = canvas.getContext("2d");

const pose = new Pose({
 locateFile: file => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
});

pose.setOptions({
 modelComplexity: 1,
 smoothLandmarks: true
});

pose.onResults(results => {
 ctx.clearRect(0,0,canvas.width,canvas.height);
 ctx.drawImage(results.image,0,0);

 if(results.poseLandmarks){
  drawConnectors(ctx, results.poseLandmarks, POSE_CONNECTIONS);
  drawLandmarks(ctx, results.poseLandmarks);
  postureJudge(results.poseLandmarks);

 }
});

upload.onchange = async e=>{
 const img = new Image();
 img.src = URL.createObjectURL(e.target.files[0]);

 img.onload = async ()=>{
  canvas.width = img.width;
  canvas.height = img.height;
  await pose.send({image: img});
 }
}

</script>

</body>
</html>


